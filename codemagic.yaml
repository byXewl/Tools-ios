workflows:
  unsigned-swift-build:
    name: Unsigned Swift Build
    environment:
      xcode: 15.4
    scripts:
      - name: Resolve SPM & Pods
        script: |
          # 如果用 CocoaPods
          [ -f Podfile ] && pod install --repo-update
          # 拉取 SPM 依赖
          xcodebuild -resolvePackageDependencies -workspace Tools.xcworkspace -scheme Tools
      - name: Build .app (Release, 无签名)
        script: |
          xcodebuild archive \
                -workspace Tools.xcworkspace \
                -scheme Tools \
                -configuration Release \
                -archivePath "$PWD/build/Tools.xcarchive" \
                CODE_SIGNING_ALLOWED=NO \
                CODE_SIGNING_REQUIRED=NO \
                CODE_SIGN_IDENTITY="" \
                PROVISIONING_PROFILE_SPECIFIER=""
      - name: Export .app 并打包
        script: |
          xcodebuild -exportArchive \
            -archivePath "$PWD/build/Tools.xcarchive" \
            -exportPath "$PWD/build/ios" \
            -exportOptionsPlist ios/ExportOptions.plist

          cd build/ios
          zip -r Tools.app.zip Tools.app
    artifacts:
      - build/ios/iphoneos/*.app.zip